<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" lang="it">
    <head>
        <% include ../views/t_head.ejs %>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    </head>
    <body>
        <div class="beer">
            <div class="screen80percent">
                <%
                    var classifica = database[0].coppaChiosco

                    classifica.sort((a,b) =>  a.qty - b.qty )
                %>
                <div class="coppa-chiosco">
                    <% 
                        var index = 1
                        for(var i=classifica.length-1; i>=0; i--) {
                    %>
                        <div class="team pos-<%= index %>" id="<%= classifica[i].nome.replace(/ /g, '_') %>" pos="<%= index %>">
                            <div class="posizione">
                                <% if(index==1){%>
                                    <!--<img src="/images/coppa-chiosco-1.png"/>-->
                                <%}%>
                                <%= index %>°
                            </div>
                            <div class="nome">
                                <%= classifica[i].nome %>
                            </div>
                            <div class="qty">
                                <%=classifica[i].qty%>
                            </div>
                        </div>                                
                    <%
                        index++
                        }
                    %>
                </div>
            </div>
        </div>

        <style>

            .beer {
                background-image: url(/images/beer.gif);
                background-size: cover;
                padding: 20px 0;
            }
            h1 {
                margin: 20px;
            }

            hr {
                margin: 0;
            }

            .coppa-chiosco {
                position: relative;
                height: 1500px;
            }
            .coppa-chiosco .team {
                display: flex;
                text-align: center;
                font-size: 25px;
                font-family: Arial Rounded MT Bold;
                font-weight: bold;
                padding: 10px;
                margin: 10px 0;
                border: 5px solid #000;
                position: absolute;
                width: 100%;
                transition: top 2000ms;
                background: #FFF;
            }

            .coppa-chiosco .team.pos-1 {
                /*background-color: gold;*/
                background: linear-gradient(90deg, rgba(139,111,22,1) 0%, rgba(219,193,85,1) 25%, rgba(250,234,137,1) 50%, rgba(219,193,85,1) 75%, rgba(139,111,22,1) 100%);
                font-size: 60px;
                top: 0;
                z-index: 12;
            }

            .coppa-chiosco .team.pos-2 {
                /*background-color: silver;*/
                background: linear-gradient(90deg, rgba(107,107,105,1) 0%, rgba(171,169,164,1) 25%, rgba(222,221,215,1) 50%, rgba(171,169,164,1) 75%, rgba(107,107,105,1) 100%);
                font-size: 50px;
                top: 150px;
                z-index: 11;
            }

            .coppa-chiosco .team.pos-3 {
                /*background-color: #cd7f32;*/
                background: linear-gradient(90deg, rgba(134,83,32,1) 0%, rgba(205,127,50,1) 25%, rgba(254,174,95,1) 50%, rgba(205,127,50,1) 75%, rgba(134,83,32,1) 100%);
                font-size: 40px;
                top: 275px;
                z-index: 10;
            }

            .coppa-chiosco .team.pos-4 {
                top: 385px;
                z-index: 9;
            }
            .coppa-chiosco .team.pos-5 {
                top: 470px;
                z-index: 8;
            }
            .coppa-chiosco .team.pos-6 {
                top: 555px;
                z-index: 7;
            }
            .coppa-chiosco .team.pos-7 {
                top: 640px;
                z-index: 6;
            }
            .coppa-chiosco .team.pos-8 {
                top: 725px;
                z-index: 5;
            }
            .coppa-chiosco .team.pos-9 {
                top: 810px;
                z-index: 4;
            }
            .coppa-chiosco .team.pos-10 {
                top: 895px;
                z-index: 3;
            }

            .coppa-chiosco .team.pos-11 {
                top: 980px;
                z-index: 2;
            }
            .coppa-chiosco .team.pos-12 {
                top: 1065px;
                z-index: 1;
            }
            .coppa-chiosco .team.pos-13 {
                top: 1150px;
                z-index: 1;
            }
            .coppa-chiosco .team.pos-14 {
                top: 1235px;
                z-index: 1;
            }
            .coppa-chiosco .team.pos-15 {
                top: 1320px;
                z-index: 1;
            }
            .coppa-chiosco .team.pos-16 {
                top: 1405px;
                z-index: 1;
            }
            .coppa-chiosco .team .posizione {
                width: 10%
            }
            .coppa-chiosco .team .nome {
                width: 75%
            }
            .coppa-chiosco .team .qty {
                width: 15%
            }

            @media (max-width: 600px) {
                .beer {
                    padding: 0;
                    padding-top: 20px;
                }

                .coppa-chiosco .team {
                    padding: 0px;
                    margin: 0px;
                    border: 0px;
                    font-size: 14px;
                }
                .coppa-chiosco .team > div {
                    padding: 10px 5px;
                    border-bottom: 5px solid;
                    border-top: 5px solid;
                }
                .coppa-chiosco .team.pos-1 {
                    font-size: 20px;
                }

                .coppa-chiosco .team.pos-2 {
                    font-size: 18px;
                }

                .coppa-chiosco .team.pos-3 {
                    font-size: 16px;
                }
                .posizione img {
                    width: 30px;
                    height: 30px;
                }

                .coppa-chiosco .team .nome {
                    text-overflow: ellipsis !important;
                    overflow: hidden !important;
                    white-space: nowrap;
                }
                .screen80percent {
                    margin: auto 1%;
                }

                .coppa-chiosco .team .posizione {
                    border-left: 5px solid;
                }
                .coppa-chiosco .team .qty {
                    border-right: 5px solid;
                }


                .coppa-chiosco .team.pos-1 {
                    top: 0;
                }
                .coppa-chiosco .team.pos-2 {
                    top: 82px;
                }
                .coppa-chiosco .team.pos-3 {
                    top: 162px;
                }
                .coppa-chiosco .team.pos-4 {
                    top: 237px;
                }
                .coppa-chiosco .team.pos-5 {
                    top: 309px;
                }
                .coppa-chiosco .team.pos-6 {
                    top: 381px;
                }
                .coppa-chiosco .team.pos-7 {
                    top: 453px;
                }
                .coppa-chiosco .team.pos-8 {
                    top: 525px;
                }
                .coppa-chiosco .team.pos-9 {
                    top: 597px;
                }
                .coppa-chiosco .team.pos-10 {
                    top: 669px;
                }
                .coppa-chiosco .team.pos-11 {
                    top: 741px;
                }
                .coppa-chiosco .team.pos-12 {
                    top: 813px;
                }
                .coppa-chiosco .team.pos-13 {
                    top: 885px;
                }
                .coppa-chiosco .team.pos-14 {
                    top: 957px;
                }
                .coppa-chiosco .team.pos-15 {
                    top: 1029px;
                }
                .coppa-chiosco .team.pos-16 {
                    top: 1101px;
                }
                .coppa-chiosco {
                    position: relative;
                    height: 1200px;
                }
            }
            
        </style>
            
        <script>
            /*
            setTimeout(function(){
                window.location.reload()
            }, 1000)
            */
            setInterval(function(){
                $.ajax({
                    url: "/cc_classifica_script",
                    dataType : "html",
                    success: function(result){
                        $('.nuovaClassifica').remove()
                        $('body').append(result)
                        aggiornaClassifica()
                    }
                });
            }, 10000)
            

            function aggiornaClassifica(){
                //console.log(nuovaClassifica)
                for(var i=0;i<nuovaClassifica.length;i++){
                    var that = nuovaClassifica[i]
                    //console.log(that.punti)
                    $('div[id="' + that.id + '"]').find('.qty').html(that.punti)
                }

                aggiornaPosizioni()
            }
            function aggiornaPosizioni(){
                for(var i=0;i<nuovaClassifica.length;i++){
                    var that = nuovaClassifica[i],
                        thatEl = $('div[id="' + that.id + '"]')
                    //console.log(that.punti)
                    if(i != (parseInt(thatEl.attr('pos'))-1)){
                        var newPos = i+1
                        thatEl.removeClass('pos-' + thatEl.attr('pos'))
                        thatEl.find('.posizione').html(newPos + '°')
                        thatEl.addClass('pos-' + newPos)
                        thatEl.attr('pos', newPos)
                    }
                    
                }
            }
        </script>
    </body>
</html>